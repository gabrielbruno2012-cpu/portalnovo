<html>
<head>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<!-- üîê Prote√ß√£o -->
<script>
const uStr = localStorage.getItem("usuario");
let u = null;
try { u = uStr ? JSON.parse(uStr) : null; } catch(e){ u = null; }

if (!u || (u.role !== "financeiro" && u.role !== "admin")) {
  window.location.href = "/";
}
</script>

<div id="sidebar"></div>

<div class="main">

  <div class="header-right">
    <button class="btn" onclick="localStorage.clear(); location='/'">Logout</button>
  </div>

  <h1>Criar Colaborador</h1>

  <div class="card" style="margin-top:20px; padding:20px;">

      <div class="form-group">
        <label>Nome*</label>
        <input id="nome" class="input" type="text" placeholder="Digite o nome completo">
      </div>

      <div class="form-group">
        <label>Email*</label>
        <input id="email" class="input" type="email" placeholder="email@exemplo.com">
      </div>

      <div class="form-group">
        <label>Senha*</label>
        <input id="senha" class="input" type="password" placeholder="Digite uma senha">
      </div>

      <div class="form-group">
        <label>Telefone</label>
        <input id="telefone" class="input" type="text" placeholder="(00) 00000-0000">
      </div>

      <div class="form-group">
        <label>CNPJ</label>
        <input id="cnpj" class="input" type="text" placeholder="00.000.000/0000-00">
      </div>

      <div class="form-group">
        <label>Tipo de Usu√°rio</label>
        <select id="role" class="input">
          <option value="colaborador">Colaborador</option>
          <option value="prestador">Prestador</option>
        </select>
      </div>

      <button class="btn" onclick="criar()" style="margin-top:15px;">Criar</button>

      <p id="msg" style="margin-top:15px; font-weight:bold;"></p>

  </div>
</div>

<script>
// Carregar o menu lateral
fetch("/admin/sidebar_admin.html")
  .then(r => r.text())
  .then(h => sidebar.innerHTML = h);

// Fun√ß√£o de criar colaborador
async function criar() {
  let nome = document.getElementById("nome").value.trim();
  let email = document.getElementById("email").value.trim();
  let senha = document.getElementById("senha").value.trim();
  let telefone = document.getElementById("telefone").value.trim();
  let cnpj = document.getElementById("cnpj").value.trim();
  let role = document.getElementById("role").value;

  if (!nome || !email || !senha) {
    msg.innerText = "Preencha os campos obrigat√≥rios!";
    msg.style.color = "red";
    return;
  }

  const dados = { nome, email, senha, role, cnpj, telefone };

  const res = await fetch("/api/usuarios", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(dados)
  });

  if (res.ok) {
    msg.innerText = "Colaborador criado com sucesso!";
    msg.style.color = "lightgreen";

    // Limpar inputs
    nome.value = "";
    email.value = "";
    senha.value = "";
    telefone.value = "";
    cnpj.value = "";

  } else {
    msg.innerText = "Erro ao criar colaborador!";
    msg.style.color = "red";
  }
}
</script>

<style>
.form-group {
  margin-bottom: 15px;
  color: white;
}
.form-group label {
  display: block;
  margin-bottom: 5px;
}
</style>

</body>
</html>
